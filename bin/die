#!/bin/bash

# Kills processes based on process name.

if [ "#1" = "-p" ]; then
	PRETEND=1
	shift
fi

if [ ! "$1" ]; then
	echo "usage: $0 [-p] REGEX"
	echo "kills all processes matching REGEX. -p enables pretend mode."
	exit 1
fi

LIST="`ps -ww -w -o pid,user,command | egrep -v "bin/die|grep" | grep "$1"`"
if [ "$LIST" = "" ]; then
	echo "no processes found"
	exit 0
fi

echo "`echo "$LIST" | wc -l` processes found:"
echo "$LIST"

KCMD="kill -9 `echo "$LIST" | sed "s/^ *//g" | cut -d" " -f1 | tr '\n' ' '`"

if [ -z "$PRETEND" ]; then
	echo -n "running '$KCMD' ... "
	eval "$KCMD"
else
	echo -n "pretend '$KCMD' ... "
fi
echo "done"
exit 0
