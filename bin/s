#!/bin/bash

# Show git status for all directories in current directory.

if [[ "$1" == "--help" || "$1" == "-h" ]]; then
    echo "usage: ${0##*/} [-h|--help] [git command]" 1>&2
    echo "Print out the git status, or given command, of all subdirectories of the current directory." 1>&2
    exit 1
fi

source "$HOME/.shell_control" || echo "$(tput bold)error: ~/.shell_control not installed!$(tput sgr0)" >&2

CMD="git status -uno"
if [[ -n "$1" ]]; then
    CMD="$@"
fi

IFS=$'\n'
for I in $(find . -not -path . -maxdepth 1 -type d); do
    cd "$I" || abort "can't enter $I"

    if [[ -d .git ]]; then
        show "$(tput bold)========== $I ==========$(tput sgr0)"
        run "$CMD"
        echo -ne $"\n\n"
    fi

    cd - >/dev/null
done
