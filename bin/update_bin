#!/bin/bash

# Syncs ./bin with ~/bin.

if [[ "$1" == "--help" || "$1" == "-h" ]]; then
    echo "usage: ${0##*/} [-h|--help]" 1>&2
    echo "Copies scripts in ~/bin into ./bin. Honors ignore file." 1>&2
    exit 1
fi

source "$HOME/.shell_control" || echo "$(tput bold)error: ~/.shell_control not installed!$(tput sgr0)" >&2

EXCLUDES=(install usages macosver update_bin ignore)

if [[ -f ignore ]]; then
    while read I; do EXCLUDES+=("$I"); done < ignore
fi

CMD="rsync -apl"

for I in "${EXCLUDES[@]}"; do
    CMD="$CMD --exclude '$I'"
done

run "$CMD --delete ~/bin/ ." || abort "could not update bin"
run "../util/update_setup_items.py > setup.new"
run "mv -f setup.new setup"
run "chmod +x setup"
run "./usages -v >README.md"
